<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>County Map</title>
<style>
body {
	padding: 0px;
	margin: 0px;
	font-family: Gotham, "Helvetica Neue", Helvetica, Arial, sans-serif;
	font-size:12px;
}
#inputs {
	padding:5px;	
}
#textLog {
	font-family: Consolas, "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", Monaco, "Courier New", monospace;
}
#theMap {
	width: 96%;
	padding: 1%;
	margin: 0px;
}
</style>
</head>
<body>
<div id="inputs">
    <p>Year:
      <select id="yearSelect">
        <option value="2013">2013</option>
        <option value="2012">2012</option>
      </select>
    </p>
    <p>Dataset: (ACS data profile table id) 
      <input id="dataset" type="text" size="12" value="DP03_0099"/> <a href="http://api.census.gov/data/2013/acs1/profile/variables.html">http://api.census.gov/data/2013/acs1/profile/variables.html</a>
    </p>
    <p>Denominator: (ACS data profile table id)
      <input id="denominator" type="text" size="12" value="DP03_0095"/> <a href="http://api.census.gov/data/2013/acs1/profile/variables.html">http://api.census.gov/data/2013/acs1/profile/variables.html</a>
    </p>
    <p>Show: <br />
      <input type="checkbox" id="showDots" checked/>
      Dataset Dots (one dot =
      <input id="dotEquals" type="text" size="6" value="10000"/>
      )<br />
      <input type="checkbox" id="showShading" checked>
      Percentage Shading</p>
    <button id="redraw">Redraw Map</button>
</div>
<div id="theMap"> </div>
<pre>

<div id="textLog">
</div>
</pre>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="d3/d3.js"></script>
<script src="key.js"></script>
<script src="pip.js"></script>
<script src="logger.js"></script>
<script src="datagrabber.js"></script>
<script src="postprocessing.js"></script>
<script src="mapdrawer.js"></script>
<script>

$(document).ready(function() {
	
	var a = new logger("textLog");
	
	$("#redraw").click(function() {
		
		var theModel = {};
		
		var requests = [
			[$("#denominator").val(),"denominator"],
			[$("#dataset").val(),"dataset"]
		];
		
		var theGrabber = new dataGrabber(	cbpp_census_api_key,
											"http://api.census.gov/data/"+$("#yearSelect").val() +"/acs1/profile/?",
											theModel,
											requests	);
										
								
		theGrabber.processRequests(function() {
			console.log(theModel);
			var pp = new postProcessing(theModel);
			pp.calcOutOfCounty();
			
			var theOptions = {
				showDots:$("#showDots").is(":checked"),
				useShading:$("#showShading").is(":checked"),
				dotSize:$("#dotEquals").val()
			};
			
			var map = new mapDrawer(theModel,"theMap",theOptions);
			map.getData("FIPSpaths.php",function() {
				map.draw();	
			});
		});
	
	});
	
	$("#redraw").click();
});


</script>
</html>
